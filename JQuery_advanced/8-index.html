<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Task 8</title>
    <script type="application/javascript" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
      #results {
        margin-top: 20px;
        list-style: none;
        padding: 0;
      }
      article {
        margin-bottom: 15px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }
      #pagination {
        display: flex;
        margin-top: 20px;
      }
      #pagination li {
        margin-left: 10px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <ul id="results"></ul>
    <ul id="pagination"></ul>

    <script type="application/javascript">
      function createSearchForm() {
        const form = $('<form>');
        const inputText = $('<input>').attr('type', 'text').attr('placeholder', 'Search Wikipedia');
        const inputSubmit = $('<input>').attr('type', 'submit').val('Search');

        form.append(inputText, inputSubmit);

        form.submit(function (e) {
          e.preventDefault();
          const query = inputText.val();
          queryWikipedia(query, 0); // Start from offset 0
        });

        $('body').prepend(form);
      }

      function createSearchArticle(id, title, snippet) {
        const article = $('<article>');
        const p1 = $('<p>').append(
          $('<span>').text('id: '),
          $('<b>').text(id)
        );
        const p2 = $('<p>').html(`<strong>${title}</strong>: ${snippet}`);
        article.append(p1, p2);
        $('#results').append($('<li>').append(article));
      }

      function addArticle(data) {
        $('#results').empty();
        const results = data.query.search;
        results.forEach(result => {
          createSearchArticle(result.pageid, result.title, result.snippet);
        });

        const totalHits = data.query.searchinfo.totalhits;
        buildPagination(totalHits, 10, data.continue?.sroffset || 0);
      }

      function queryWikipedia(search, offset = 0) {
        const data = {
          action: 'query',
          list: 'search',
          srsearch: search,
          sroffset: offset,
          format: 'json',
          origin: '*'
        };

        $.ajax({
          url: 'https://en.wikipedia.org/w/api.php',
          data: data,
          dataType: 'json',
          success: function (response) {
            response.searchTerm = search; // Store the term for pagination reuse
            addArticle(response);
          }
        });
      }

      function buildPagination(numberOfItems, itemsPerPage, currentOffset) {
        $('#pagination').empty();
        const totalPages = Math.ceil(numberOfItems / itemsPerPage);
        for (let i = 0; i < totalPages; i++) {
          const pageItem = $('<li>').text(i + 1).css({ cursor: 'pointer', marginLeft: '10px' });
          pageItem.click(function () {
            const newOffset = i * itemsPerPage;
            const searchTerm = $('form input[type="text"]').val();
            queryWikipedia(searchTerm, newOffset);
          });
          $('#pagination').append(pageItem);
        }
      }

      createSearchForm();
    </script>
  </body>
</html>